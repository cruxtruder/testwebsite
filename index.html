<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Roblox T-Shirt Generator</title>
    <style>
        @font-face {
            font-family: 'SpecialFont';
            src: url('fonts/noobic-military-police.ttf');
        }

        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; padding: 40px; }
        .editor { display: flex; gap: 40px; background: #2a2a2a; padding: 30px; border-radius: 15px; border: 1px solid #444; }
        
        .controls { width: 300px; display: flex; flex-direction: column; gap: 20px; }
        canvas { 
            background: #000;
            image-rendering: pixelated; 
            width: 384px; height: 384px; /* 3x Zoom for visibility */
            border: 2px solid #000;
        }

        input[type="text"] { padding: 10px; border-radius: 5px; border: none; font-size: 16px; text-transform: uppercase; background: #333; color: white; }
        .ribbon-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .ribbon-btn { cursor: pointer; border: 2px solid transparent; border-radius: 5px; background: #333; transition: 0.2s; position: relative; }
        .ribbon-btn.active { border-color: #00ff00; background: #444; }
        .ribbon-btn img { width: 100%; display: block; image-rendering: pixelated; }
        
        .ribbon-btn.active::after {
            content: attr(data-order);
            position: absolute; top: -5px; right: -5px; background: #00ff00; 
            color: black; font-size: 10px; font-weight: bold; padding: 2px 5px; border-radius: 50%;
        }

        .download-btn { background: #00ff00; color: black; font-weight: bold; padding: 15px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <h2>T-Shirt Label Generator</h2>

    <div class="editor">
        <div class="controls">
            <label>Name (Max 8 Characters)</label>
            <input type="text" id="userName" maxlength="8" placeholder="ENTER NAME" oninput="updateCanvas()">

            <label>Select Ribbons</label>
            <div class="ribbon-grid" id="ribbonGrid">
                <div class="ribbon-btn" onclick="toggleRibbon('Academy Graduate Ribbon.png', this)"><img src="ribbons/Academy Graduate Ribbon.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('Distinguished Service 2nd Class.png', this)"><img src="ribbons/Distinguished Service 2nd Class.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('Distinguished Service 3rd Class.png', this)"><img src="ribbons/Distinguished Service 3rd Class.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('Distinguished Service 4th Class.png', this)"><img src="ribbons/Distinguished Service 4th Class.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('Founding Member Ribbon.png', this)"><img src="ribbons/Founding Member Ribbon.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('General Body Commendation.png', this)"><img src="ribbons/General Body Commendation.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('NCO Commendation Ribbon.png', this)"><img src="ribbons/NCO Commendation Ribbon.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('Squid Game Winner Ribbon.png', this)"><img src="ribbons/Squid Game Winner Ribbon.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('f.png', this)"><img src="ribbons/f.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('green.png', this)"><img src="ribbons/green.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('idk.png', this)"><img src="ribbons/idk.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('plus.png', this)"><img src="ribbons/plus.png"></div>
                <div class="ribbon-btn" onclick="toggleRibbon('s.png', this)"><img src="ribbons/s.png"></div>
            </div>
            <button class="download-btn" onclick="download()">Download 128x128 PNG</button>
        </div>

        <div class="preview">
            <canvas id="tshirtCanvas" width="128" height="128"></canvas>
            <p style="text-align:center; color: #888;">Preview (3x Zoom)</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('tshirtCanvas');
        const ctx = canvas.getContext('2d');
        let selectedRibbons = [];

        const RIBBON_W = 11;
        const RIBBON_H = 5;
        const GRID_START_X = 9;
        const GRID_START_Y = 30;
        const MAX_PER_ROW = 3;

        // Coordinates for text box
        const BOX_CENTER_X = 99;
        const BOX_BOTTOM_Y = 41; 
        const BOX_WIDTH = 28;

        function toggleRibbon(filename, el) {
            const path = 'ribbons/' + filename;
            const index = selectedRibbons.indexOf(path);

            if (index > -1) {
                selectedRibbons.splice(index, 1);
                el.classList.remove('active');
                el.removeAttribute('data-order');
            } else {
                selectedRibbons.push(path);
                el.classList.add('active');
            }

            document.querySelectorAll('.ribbon-btn.active').forEach(btn => {
                const btnPath = 'ribbons/' + btn.getAttribute('onclick').split("'")[1];
                const orderNum = selectedRibbons.indexOf(btnPath) + 1;
                btn.setAttribute('data-order', orderNum);
            });

            updateCanvas();
        }
        
        async function updateCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 1. Essential for pixel-art: Disable all smoothing
            ctx.imageSmoothingEnabled = false;

            // 2. Draw Template (blank.png)
            try {
                const template = await loadImage('blank.png');
                ctx.drawImage(template, 0, 0, 128, 128);
            } catch (e) {
                console.warn("blank.png not found.");
            }

            // 3. Draw Text (Pixel-perfect centering in 5px high box)
            const name = document.getElementById('userName').value.toUpperCase();
            
            // Set font size to 5px to match your box height
            ctx.font = "1px 'SpecialFont'"; 
            ctx.fillStyle = "white";
            
            // Centering Logic
            ctx.textAlign = "center";   // Centers horizontally on X
            ctx.textBaseline = "top"; // Centers vertically on Y
            
            // X = 99 (Center of 85-113)
            // Y = 37 (The very top of your 37-41 box)
            // We use Math.floor to ensure we aren't on a "half-pixel"
            ctx.fillText(name, Math.floor(99), Math.floor(37));

            // 4. Draw Ribbons
            for (let i = 0; i < selectedRibbons.length; i++) {
                const row = Math.floor(i / MAX_PER_ROW);
                const col = i % MAX_PER_ROW;
                const x = GRID_START_X + (col * RIBBON_W);
                const y = GRID_START_Y + (row * RIBBON_H);

                try {
                    const img = await loadImage(selectedRibbons[i]);
                    ctx.drawImage(img, x, y, RIBBON_W, RIBBON_H);
                } catch (e) { console.error(e); }
            }
        }

        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src + "?t=" + new Date().getTime(); // Prevent cache issues
            });
        }

        function download() {
            const link = document.createElement('a');
            link.download = 'tshirt.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
        }

        document.fonts.ready.then(() => updateCanvas());
    </script>
</body>
</html>
